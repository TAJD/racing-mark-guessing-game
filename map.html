<!DOCTYPE html>

<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Saronic Gulf Sailing Trip</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.js"></script>
    <style>
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #f0f9ff;
        }
        .header {
            background: linear-gradient(135deg, #1e40af, #3b82f6);
            color: white;
            padding: 1rem 2rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .header h1 {
            margin: 0;
            font-size: 1.75rem;
            font-weight: bold;
        }
        .header p {
            margin: 0.25rem 0 0 0;
            opacity: 0.9;
            font-size: 0.95rem;
        }
        .map-controls {
            background: white;
            padding: 1rem 2rem;
            border-bottom: 1px solid #e2e8f0;
        }
        .map-controls button {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            margin-right: 0.5rem;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9rem;
        }
        .map-controls button:hover {
            background: #2563eb;
        }
        .map-controls button.active {
            background: #1d4ed8;
        }
        .container {
            display: flex;
            height: calc(100vh - 160px);
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        #map {
            flex: 1;
            min-height: 600px;
        }
        .sidebar {
            width: 350px;
            background: #f8fafc;
            padding: 1.5rem;
            overflow-y: auto;
            border-left: 1px solid #e2e8f0;
        }
        .trip-summary {
            background: white;
            padding: 1rem;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-bottom: 1.5rem;
        }
        .trip-summary h3 {
            margin: 0 0 0.75rem 0;
            color: #1e40af;
            font-size: 1.1rem;
        }
        .summary-item {
            display: flex;
            justify-content: space-between;
            margin: 0.5rem 0;
            font-size: 0.9rem;
        }
        .summary-label {
            color: #64748b;
        }
        .summary-value {
            font-weight: 600;
            color: #1e293b;
        }
        .legend {
            background: white;
            padding: 1rem;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-bottom: 1.5rem;
        }
        .legend h3 {
            margin: 0 0 0.75rem 0;
            color: #1e40af;
            font-size: 1.1rem;
        }
        .legend-item {
            display: flex;
            align-items: center;
            margin: 0.5rem 0;
            font-size: 0.85rem;
        }
        .legend-icon {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            margin-right: 0.5rem;
            border: 2px solid white;
            box-shadow: 0 1px 3px rgba(0,0,0,0.3);
        }
        .leg-details {
            background: white;
            padding: 1rem;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border-left: 4px solid #3b82f6;
        }
        .leg-details h4 {
            margin: 0 0 0.75rem 0;
            color: #1e40af;
            font-size: 1rem;
        }
        .detail-item {
            margin: 0.5rem 0;
            font-size: 0.85rem;
        }
        .detail-label {
            font-weight: 600;
            color: #374151;
        }
        .detail-value {
            color: #6b7280;
        }
        .notes {
            background: #f1f5f9;
            padding: 0.75rem;
            border-radius: 6px;
            margin-top: 0.75rem;
            font-size: 0.8rem;
            color: #475569;
            line-height: 1.4;
        }
        .map-error {
            background: #fef2f2;
            border: 2px dashed #fca5a5;
            color: #dc2626;
            padding: 2rem;
            text-align: center;
            margin: 1rem;
            border-radius: 8px;
        }

```
    /* Responsive design */
    @media (max-width: 768px) {
        .container {
            flex-direction: column;
            height: auto;
        }
        .sidebar {
            width: 100%;
            max-height: 300px;
        }
        #map {
            height: 500px;
        }
    }
</style>
```

</head>
<body>
    <div class="header">
        <h1>‚öì Saronic Gulf Sailing Trip</h1>
        <p>üìç Total Distance: 146.7 NM | ‚õµ Boat Speed: Engine 5kts, Sail 7kts | üìÖ 6 Days</p>
    </div>

```
<div class="map-controls">
    <button id="osm-btn" class="active">OpenStreetMap</button>
    <button id="carto-btn">CartoDB</button>
    <button id="topo-btn">Topographic</button>
    <button id="satellite-btn">Satellite</button>
    <span style="margin-left: 1rem; color: #6b7280;">Try different map providers if one doesn't load</span>
</div>

<div class="container">
    <div id="map">
        <div class="map-error" id="map-error" style="display: none;">
            <h3>Map Loading Issue</h3>
            <p>Some map providers may be blocked in this environment. Try switching providers above, or:</p>
            <ul style="text-align: left; margin-top: 1rem;">
                <li>Copy this HTML file and open it in your browser</li>
                <li>Use Google My Maps or similar online tools</li>
                <li>The interactive SVG version still shows all route details</li>
            </ul>
        </div>
    </div>
    
    <div class="sidebar">
        <div class="trip-summary">
            <h3>Trip Summary</h3>
            <div class="summary-item">
                <span class="summary-label">Duration:</span>
                <span class="summary-value">6 Days</span>
            </div>
            <div class="summary-item">
                <span class="summary-label">Total Distance:</span>
                <span class="summary-value">146.7 NM</span>
            </div>
            <div class="summary-item">
                <span class="summary-label">Destinations:</span>
                <span class="summary-value">7 Stops</span>
            </div>
            <div class="summary-item">
                <span class="summary-label">Average Speed:</span>
                <span class="summary-value">~6 knots</span>
            </div>
        </div>

        <div class="legend">
            <h3>Legend</h3>
            <div class="legend-item">
                <div class="legend-icon" style="background-color: #059669;"></div>
                <span>üèÅ Start/End Point</span>
            </div>
            <div class="legend-item">
                <div class="legend-icon" style="background-color: #dc2626;"></div>
                <span>‚öì Overnight Stop</span>
            </div>
            <div class="legend-item">
                <div class="legend-icon" style="background-color: #0891b2;"></div>
                <span>üíß Water Stop</span>
            </div>
            <div class="legend-item">
                <div class="legend-icon" style="background-color: #d97706;"></div>
                <span>üçΩÔ∏è Lunch Stop</span>
            </div>
            <div class="legend-item">
                <div style="width: 20px; height: 3px; background-color: #3b82f6; margin-right: 0.25rem; border-radius: 2px;"></div>
                <span>üìç Route Segments</span>
            </div>
        </div>

        <div class="leg-details" id="leg-info">
            <h4>Click on route segments or markers for details</h4>
            <p style="color: #6b7280; font-size: 0.85rem;">
                The map shows your complete sailing route through the Saronic Gulf. 
                Click on any blue route line or destination marker to see detailed 
                information about that leg of the journey.
            </p>
        </div>
    </div>
</div>

<script>
    let map;
    let currentLayer;
    let routeLayersGroup;

    // Define destinations with coordinates
    const destinations = [
        { id: 'alimos', name: 'Alimos (Athens)', coords: [37.914, 23.726], type: 'start', icon: 'üèÅ' },
        { id: 'sounion', name: 'Sounion', coords: [37.651, 24.026], type: 'stop', icon: '‚öì' },
        { id: 'aigina-town', name: 'Aigina Town', coords: [37.746, 23.431], type: 'stop', icon: '‚öì' },
        { id: 'poros', name: 'Poros', coords: [37.510, 23.457], type: 'water', icon: 'üíß' },
        { id: 'dokos', name: 'Dokos', coords: [37.354, 23.228], type: 'stop', icon: '‚öì' },
        { id: 'epidavros', name: 'Epidavros', coords: [37.630, 23.137], type: 'stop', icon: '‚öì' },
        { id: 'nisis-mini', name: 'Nisis Mini', coords: [37.52, 23.40], type: 'lunch', icon: 'üçΩÔ∏è' },
        { id: 'aigina-other', name: 'Aigina (Other Side)', coords: [37.72, 23.42], type: 'stop', icon: '‚öì' }
    ];

    // Define legs with detailed information
    const legs = [
        {
            id: 1,
            from: 'alimos',
            to: 'sounion',
            day: 'Sunday',
            departure: '10:00 AM',
            arrival: '~1:15 PM',
            distance: '19.6 NM',
            time: '~3h 15m',
            notes: 'Overnight: Sounion (Anchorage near Temple of Poseidon)',
            color: '#3b82f6'
        },
        {
            id: 2,
            from: 'sounion',
            to: 'aigina-town',
            day: 'Monday',
            departure: '10:00 AM',
            arrival: '~1:25 PM',
            distance: '20.5 NM',
            time: '~3h 25m',
            notes: 'Overnight: Aigina Town Port',
            color: '#8b5cf6'
        },
        {
            id: 3,
            from: 'aigina-town',
            to: 'dokos',
            via: 'poros',
            day: 'Tuesday',
            departure: '10:00 AM',
            arrival: '~4:30-5:00 PM',
            distance: '33.8 NM',
            time: '~5h 40m',
            notes: 'Stop at Poros for water refill. Overnight: Dokos Island (Skindos Bay)',
            color: '#10b981'
        },
        {
            id: 4,
            from: 'dokos',
            to: 'epidavros',
            day: 'Wednesday',
            departure: '10:00 AM',
            arrival: '~4:20 PM',
            distance: '37.9 NM',
            time: '~6h 20m',
            notes: 'Overnight: Epidavros (Rocks taverna "Mouira")',
            color: '#f59e0b'
        },
        {
            id: 5,
            from: 'epidavros',
            to: 'aigina-other',
            via: 'nisis-mini',
            day: 'Thursday',
            departure: '10:00 AM',
            arrival: '~2:30-3:30 PM',
            distance: '14.6 NM',
            time: '~4.5-5.5h',
            wind: 'N 5-10 knots',
            notes: 'Long lunch at Nisis Mini (2-3h). Overnight: Perdika/Marathonas Bay',
            color: '#ef4444'
        },
        {
            id: 6,
            from: 'aigina-other',
            to: 'alimos',
            day: 'Friday',
            departure: '12:35 PM',
            arrival: '~4:00 PM',
            distance: '20.3 NM',
            time: '~3h 25m',
            wind: 'NNW 10 knots',
            notes: 'Return to Alimos (Athens)',
            color: '#6366f1'
        }
    ];

    // Map tile layers
    const tileLayers = {
        osm: L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '¬© OpenStreetMap contributors'
        }),
        carto: L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png', {
            attribution: '¬© OpenStreetMap contributors ¬© CARTO'
        }),
        topo: L.tileLayer('https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png', {
            attribution: '¬© OpenStreetMap contributors ¬© OpenTopoMap'
        }),
        satellite: L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
            attribution: '¬© Esri ¬© HERE ¬© Garmin ¬© SafeGraph'
        })
    };

    // Initialize map
    function initMap() {
        try {
            map = L.map('map').setView([37.65, 23.45], 10);
            currentLayer = tileLayers.osm;
            currentLayer.addTo(map);
            
            // Create layer group for routes
            routeLayersGroup = L.layerGroup().addTo(map);
            
            // Add markers and routes
            addMarkersAndRoutes();
            
            // Fit map to show all markers
            const group = new L.featureGroup(destinations.map(dest => 
                L.marker(dest.coords)
            ));
            map.fitBounds(group.getBounds().pad(0.1));
            
            // Hide error message
            document.getElementById('map-error').style.display = 'none';
            
            // Test if tiles are loading
            setTimeout(() => {
                const tiles = document.querySelectorAll('.leaflet-tile');
                if (tiles.length === 0) {
                    document.getElementById('map-error').style.display = 'block';
                }
            }, 3000);
            
        } catch (error) {
            console.error('Map initialization failed:', error);
            document.getElementById('map-error').style.display = 'block';
        }
    }

    // Helper function to get destination by ID
    function getDestination(id) {
        return destinations.find(d => d.id === id);
    }

    // Helper function to get marker color by type
    function getMarkerColor(type) {
        switch (type) {
            case 'start': return '#059669';
            case 'water': return '#0891b2';
            case 'lunch': return '#d97706';
            default: return '#dc2626';
        }
    }

    // Add markers and routes to map
    function addMarkersAndRoutes() {
        // Clear existing routes
        routeLayersGroup.clearLayers();

        // Add markers for destinations
        destinations.forEach(dest => {
            const marker = L.circleMarker(dest.coords, {
                radius: dest.type === 'start' ? 10 : 8,
                fillColor: getMarkerColor(dest.type),
                color: 'white',
                weight: 2,
                opacity: 1,
                fillOpacity: 1
            });

            const popupContent = `
                <div style="text-align: center; min-width: 150px;">
                    <h4 style="margin: 0 0 5px 0; color: #1e40af;">
                        ${dest.icon} ${dest.name}
                    </h4>
                    <p style="margin: 0; color: #64748b; font-size: 0.9rem;">
                        ${dest.type === 'start' ? 'Start/End Point' : 
                          dest.type === 'water' ? 'Water Stop' :
                          dest.type === 'lunch' ? 'Lunch Stop' : 'Overnight Stop'}
                    </p>
                </div>
            `;
            
            marker.bindPopup(popupContent);
            
            marker.on('click', function() {
                // Find legs that involve this destination
                const relatedLegs = legs.filter(leg => 
                    leg.from === dest.id || leg.to === dest.id || leg.via === dest.id
                );
                
                if (relatedLegs.length > 0) {
                    showLegDetails(relatedLegs[0]);
                }
            });
            
            routeLayersGroup.addLayer(marker);
        });

        // Draw route segments
        legs.forEach(leg => {
            const fromDest = getDestination(leg.from);
            const toDest = getDestination(leg.to);
            
            let routeCoords = [fromDest.coords, toDest.coords];
            
            // If there's a via point, create a multi-segment route
            if (leg.via) {
                const viaDest = getDestination(leg.via);
                routeCoords = [fromDest.coords, viaDest.coords, toDest.coords];
            }
            
            const polyline = L.polyline(routeCoords, {
                color: leg.color,
                weight: 4,
                opacity: 0.8
            });
            
            polyline.on('click', function() {
                showLegDetails(leg);
            });
            
            routeLayersGroup.addLayer(polyline);
            
            // Add leg number label at midpoint
            const midpoint = routeCoords[Math.floor(routeCoords.length / 2)];
            const legLabel = L.circleMarker(midpoint, {
                radius: 12,
                fillColor: leg.color,
                color: 'white',
                weight: 2,
                opacity: 1,
                fillOpacity: 1
            });
            
            legLabel.bindTooltip(`Leg ${leg.id}`, {
                permanent: false,
                direction: 'center'
            });
            
            // Add number text
            const numberIcon = L.divIcon({
                html: `<div style="color: white; text-align: center; font-weight: bold; font-size: 11px; line-height: 24px;">${leg.id}</div>`,
                className: 'leg-number-icon',
                iconSize: [24, 24]
            });
            
            const numberMarker = L.marker(midpoint, { icon: numberIcon });
            
            legLabel.on('click', function() {
                showLegDetails(leg);
            });
            
            numberMarker.on('click', function() {
                showLegDetails(leg);
            });
            
            routeLayersGroup.addLayer(legLabel);
            routeLayersGroup.addLayer(numberMarker);
        });
    }

    // Switch map layers
    function switchLayer(layerKey) {
        if (map && currentLayer) {
            map.removeLayer(currentLayer);
        }
        currentLayer = tileLayers[layerKey];
        if (map) {
            currentLayer.addTo(map);
        }
        
        // Update button states
        document.querySelectorAll('.map-controls button').forEach(btn => {
            btn.classList.remove('active');
        });
        document.getElementById(layerKey + '-btn').classList.add('active');
    }

    // Function to display leg details in sidebar
    function showLegDetails(leg) {
        const fromDest = getDestination(leg.from);
        const toDest = getDestination(leg.to);
        const viaDest = leg.via ? getDestination(leg.via) : null;
        
        const legInfo = document.getElementById('leg-info');
        
        legInfo.innerHTML = `
            <h4>Leg ${leg.id} - ${leg.day}</h4>
            <div class="detail-item">
                <span class="detail-label">Route:</span>
                <span class="detail-value">
                    ${fromDest.name} ‚Üí ${viaDest ? viaDest.name + ' ‚Üí ' : ''}${toDest.name}
                </span>
            </div>
            <div class="detail-item">
                <span class="detail-label">Departure:</span>
                <span class="detail-value">${leg.departure}</span>
            </div>
            <div class="detail-item">
                <span class="detail-label">Arrival:</span>
                <span class="detail-value">${leg.arrival}</span>
            </div>
            <div class="detail-item">
                <span class="detail-label">Distance:</span>
                <span class="detail-value">${leg.distance}</span>
            </div>
            <div class="detail-item">
                <span class="detail-label">Est. Time:</span>
                <span class="detail-value">${leg.time}</span>
            </div>
            ${leg.wind ? `
            <div class="detail-item">
                <span class="detail-label">Wind:</span>
                <span class="detail-value">${leg.wind}</span>
            </div>
            ` : ''}
            <div class="notes">
                <strong>Notes:</strong><br>
                ${leg.notes}
            </div>
        `;
    }

    // Event listeners for map layer buttons
    document.getElementById('osm-btn').addEventListener('click', () => switchLayer('osm'));
    document.getElementById('carto-btn').addEventListener('click', () => switchLayer('carto'));
    document.getElementById('topo-btn').addEventListener('click', () => switchLayer('topo'));
    document.getElementById('satellite-btn').addEventListener('click', () => switchLayer('satellite'));

    // Initialize map when page loads
    document.addEventListener('DOMContentLoaded', initMap);

    // Add custom CSS for tooltips
    const style = document.createElement('style');
    style.textContent = `
        .leg-number-icon {
            background: none !important;
            border: none !important;
        }
    `;
    document.head.appendChild(style);
</script>
```

</body>
</html>
